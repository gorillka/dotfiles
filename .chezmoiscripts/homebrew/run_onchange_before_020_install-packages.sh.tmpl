#!/bin/bash
source {{ .chezmoi.sourceDir }}/misc/.helper.sh

set -eufo pipefail

{{ $brews := list
 	"age"
    "bat"
    "btop"
    "eza"
    "fd"
    "fzf"
    "git"
    "git-lfs"
    "gnu-units"
    "gnupg"
    "jq"
    "ripgrep"
    "tmux"
    "lazygit"
    "ffmpeg"
    "neovim"
    "oh-my-posh"
    "zsh"
-}}
{{ if eq .chezmoi.os "darwin" -}}
	{{ $brews = mustAppend $brew "mas" }}
{{ end -}}

{{ $casks := list }}
{{ if and (not .ephemeral) (not .headless) -}}
	{{ $casks = concat $casks (list "ghostty" "zed") -}}
{{ end -}}
{{ if eq .chezmoi.os "darwin" -}}
	{{ $casks = mustAppend $casks "raycast" -}}
{{ end -}}

find_brew

# Install packages
print_message "Installing packages using brew bundle"

eval "$(${BREW_PATH} shellenv)"
export HOMEBREW_NO_AUTO_UPDATE=1
brew bundle --file=/dev/stdin <<EOF
{{ range ($brews | sortAlpha | uniq) -}}
brew "{{ . }}"
{{ end -}}
{{ range ($casks | sortAlpha | uniq) -}}
cask "{{ . }}"
{{ end -}}
EOF
