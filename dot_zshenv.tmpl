# Secrets
[ -f "$HOME/.env" ] && source "$HOME/.env"

export XDG_DATA_HOME=$HOME/.local/share
export XDG_CONFIG_HOME=$HOME/.config
export XDG_STATE_HOME=$HOME/.local/state
export XDG_CACHE_HOME=$HOME/.cache

# Hide computer name in terminal
export DEFAULT_USER="$(whoami)"

# If you come from bash you might have to change your $PATH.
{{- $paths := list -}}
{{- if stat "/opt/homebrew/bin" -}}
    {{- $paths = mustAppend $paths "/opt/homebrew/bin" -}}
{{- end -}}
{{- $homeDir := .chezmoi.homeDir -}}
{{- range $_, $relPath := list "bin" "go/bin" ".cargo/bin" ".local/bin" -}}
    {{- $path := joinPath $homeDir $relPath -}}
    {{- if stat $path -}}
        {{- $paths = mustAppend $paths $path -}}
    {{- end -}}
{{- end }}
{{- if $paths }}
export PATH={{ toStrings $paths | join ":" }}:$PATH
{{- end }}

# Path to your oh-my-zsh installation.
export ZSH=$HOME/.oh-my-zsh

# Locale settings
export LANG="en_US.UTF-8" # Sets default locale for all categories
export LC_ALL="en_US.UTF-8" # Overrides all other locale settings
export LC_CTYPE="en_US.UTF-8" # Controls character classification and case conversion

# Use Neovim as default editor
{{ if stat (printf "%s/.local/bin/nvim" .chezmoi.homeDir) -}}
export EDITOR=$HOME/.local/bin/nvim
{{ else if lookPath "nvim" -}}
export EDITOR=nvim
{{ else -}}
export EDITOR=vim
{{ end -}}
if [[ "${TERM_PROGRAM:-unset}" == "vscode" ]]; then
  export VISUAL="code --wait"
else
  export VISUAL=nvim
fi
{{ if eq .chezmoi.os "darwin" }}
export SSH_AUTH_SOCK="$HOME/Library/Containers/com.bitwarden.desktop/Data/.bitwarden-ssh-agent.sock"
{{ end -}}
{{ if and (.personal) (not .ephemeral) -}}
    {{- $itemName := printf "github.com (%s)" .name }}
    {{- range (bitwarden "item" $itemName).fields }}
        {{- if eq .name "API Token" }}
export GITHUB_ACCESS_TOKEN={{ .value | trim }}
        {{- end }}
    {{- end }}
{{ end -}}
{{- if .personal -}}
export CHEZMOI_GITHUB_ACCESS_TOKEN=$GITHUB_ACCESS_TOKEN
{{- end }}

# fzf
# ------------------------------------------------------------------------------
{{ if lookPath "fzf" -}}
source <(fzf --zsh)

export FZF_CTRL_R_OPTS="
--color header:italic
--height=80%
--bind 'ctrl-y:execute-silent(echo -n {2..} | pbcopy)+abort'
--header 'CTRL-Y: Copy command into clipboard, CTRL-/: Toggle line wrapping, CTRL-R: Toggle sorting by relevance'
"
    {{ if lookPath "bat" -}}
export FZF_CTRL_T_OPTS="
--walker-skip .git,node_modules,target
--preview 'bat -n --color=always {}'
--height=80%
--bind 'ctrl-/:change-preview-window(down|hidden|)'
--header 'CTRL-/: Toggle preview window position'
"
    {{ end -}}

    {{ if lookPath "tree" -}}
export FZF_ALT_C_OPTS="
--walker-skip .git,node_modules,target
--preview 'tree -C {}'
--height=80%
--bind 'ctrl-/:change-preview-window(down|hidden|)'
--header 'CTRL-/: Toggle preview window position'
"
    {{ end -}}
{{ end -}}
